(function($){$.extend({jsonRPC:{version:"2.0",endPoint:null,namespace:null,setup:function(a){this._validateConfigParams(a);this.endPoint=a.endPoint;this.namespace=a.namespace;return this},withOptions:function(a,b){this._validateConfigParams(a);if(typeof b==="undefined")throw"No callback specified";origParams={endPoint:this.endPoint,namespace:this.namespace};this.setup(a);b.call(this);this.setup(origParams)},request:function(a,b){if(typeof b==="undefined"){b={id:1}}if(typeof b.id==="undefined"){b.id=1}this._validateRequestMethod(a);this._validateRequestParams(b.params);this._validateRequestCallbacks(b.success,b.error);this._doRequest(JSON.stringify(this._requestDataObj(a,b.params,b.id)),b);return true},batchRequest:function(a,b){if(typeof b==="undefined"){b={}}if(!$.isArray(a)||a.length===0)throw"Invalid requests supplied for jsonRPC batchRequest. Must be an array object that contain at least a method attribute";var c=this;$.each(a,function(a,b){c._validateRequestMethod(b.method);c._validateRequestParams(b.params);if(typeof b.id==="undefined"){b.id=a+1}});this._validateRequestCallbacks(b.success,b.error);var d=[],e;for(var f=0;f<a.length;f++){e=a[f];d.push(this._requestDataObj(e.method,e.params,e.id))}this._doRequest(JSON.stringify(d),b)},_validateConfigParams:function(a){if(typeof a==="undefined"){throw"No params specified"}else{if(a.endPoint&&typeof a.endPoint!=="string"){throw"endPoint must be a string"}if(a.namespace&&typeof a.namespace!=="string"){throw"namespace must be a string"}}},_validateRequestMethod:function(a){if(typeof a!=="string")throw"Invalid method supplied for jsonRPC request";return true},_validateRequestParams:function(a){if(!(a===null||typeof a==="undefined"||typeof a==="object"||$.isArray(a))){throw"Invalid params supplied for jsonRPC request. It must be empty, an object or an array."}return true},_validateRequestCallbacks:function(a,b){if(typeof a!=="undefined"&&typeof a!=="function")throw"Invalid success callback supplied for jsonRPC request";if(typeof b!=="undefined"&&typeof b!=="function")throw"Invalid error callback supplied for jsonRPC request";return true},_doRequest:function(a,b){var c=this;$.ajax({type:"POST",async:false!==b.async,dataType:"json",contentType:"application/json",url:this._requestUrl(b.url),data:a,cache:false,processData:false,error:function(a){c._requestError.call(c,a,b.error)},success:function(a){c._requestSuccess.call(c,a,b.success,b.error)}})},_requestUrl:function(a){a=a||this.endPoint;return a+"?tm="+(new Date).getTime()},_requestDataObj:function(a,b,c){var d={jsonrpc:this.version,method:this.namespace?this.namespace+"."+a:a,id:c};if(typeof b!=="undefined"){d.params=b}return d},_requestError:function(a,b){if(typeof b!=="undefined"&&typeof b==="function"){b(this._response())}},_requestSuccess:function(a,b,c){var d=this._response(a);if(d.error&&typeof c==="function"){c(d);return}if(typeof b==="function"){b(d)}},_response:function(json){if(typeof json==="undefined"){return{error:"Internal server error",version:"2.0"}}else{try{if(typeof json==="string"){json=eval("("+json+")")}if($.isArray(json)&&json.length>0&&json[0].jsonrpc!=="2.0"||!$.isArray(json)&&json.jsonrpc!=="2.0"){throw"Version error"}return json}catch(e){return{error:"Internal server error: "+e,version:"2.0"}}}}}})})(jQuery)